<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to groupr • groupr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to groupr">
<meta property="og:description" content="groupr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">groupr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to groupr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ngriffiths21/groupr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/header-attrs-2.3/header-attrs.js"></script><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to groupr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ngriffiths21/groupr/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>The groupr package is designed to make certain forms of data manipulation easier by representing the underlying data in richer ways. In particular, the standard grouping function <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">dplyr::group_by</a></code> is extended to include groups that can be marked “inapplicable” at certain values of the grouping variable. The hope is that code that can recognize these kinds of groups will be simpler to write and easier to understand. The package also provides functions for some tasks, like pivoting, that are especially well suited to this idea.</p>
<div id="the-meaning-of-inapplicable-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#the-meaning-of-inapplicable-groups" class="anchor"></a>The meaning of inapplicable groups</h2>
<p>In dplyr, groups are denoted with a grouping column that contains unique values for every group. For example, we can group <code>mtcars</code> by the variable <code>vs</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">vs</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 32 x 11</span>
<span class="co">#&gt; # Groups:   vs [2]</span>
<span class="co">#&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4</span>
<span class="co">#&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4</span>
<span class="co">#&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1</span>
<span class="co">#&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1</span>
<span class="co">#&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2</span>
<span class="co">#&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1</span>
<span class="co">#&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4</span>
<span class="co">#&gt;  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2</span>
<span class="co">#&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2</span>
<span class="co">#&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4</span>
<span class="co">#&gt; # … with 22 more rows</span></pre></div>
<p>The result is a dataset with two groups defined by <code>vs == 1</code> and <code>vs == 0</code>.</p>
<p>In <code>groups</code>, we can optionally mark one of the two groups as inapplicable:</p>
<pre><code>#&gt; # A tibble:    32 x 11
#&gt; # Row indices: vs (I: 1) [2]
#&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
#&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
#&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
#&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
#&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
#&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
#&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
#&gt;  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
#&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
#&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
#&gt; # … with 22 more rows</code></pre>
<p>What this means depends on what comes next. Here are a few possibilities:</p>
<ul>
<li>The data can be ignored for now, but we might need it later</li>
<li>The data describe a higher level in a grouping hierarchy, so they don’t need a subgroup value</li>
<li>The data should be excluded from the input of a calculation</li>
</ul>
<p>These different meanings will be clear in the context of actual data cleaning operations.</p>
</div>
<div id="data-cleaning-and-representation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleaning-and-representation" class="anchor"></a>Data cleaning and representation</h2>
<div id="pivoting" class="section level3">
<h3 class="hasAnchor">
<a href="#pivoting" class="anchor"></a>Pivoting</h3>
<div id="as-an-operation-on-groups" class="section level4">
<h4 class="hasAnchor">
<a href="#as-an-operation-on-groups" class="anchor"></a>As an operation on groups</h4>
<p>Pivoting can be thought of as a simple rearrangement of groups. Consider the iris dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 150 x 5</span>
<span class="co">#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span>
<span class="co">#&gt;  1          5.1         3.5          1.4         0.2 setosa </span>
<span class="co">#&gt;  2          4.9         3            1.4         0.2 setosa </span>
<span class="co">#&gt;  3          4.7         3.2          1.3         0.2 setosa </span>
<span class="co">#&gt;  4          4.6         3.1          1.5         0.2 setosa </span>
<span class="co">#&gt;  5          5           3.6          1.4         0.2 setosa </span>
<span class="co">#&gt;  6          5.4         3.9          1.7         0.4 setosa </span>
<span class="co">#&gt;  7          4.6         3.4          1.4         0.3 setosa </span>
<span class="co">#&gt;  8          5           3.4          1.5         0.2 setosa </span>
<span class="co">#&gt;  9          4.4         2.9          1.4         0.2 setosa </span>
<span class="co">#&gt; 10          4.9         3.1          1.5         0.1 setosa </span>
<span class="co">#&gt; # … with 140 more rows</span></pre></div>
<p>We could pivot to “longer” format by collapsing the different measurements into a single column. Equivalently, we can consider the columns <code>Seal.Length, Sepal.Width, ...</code> to describe groups of data, not distinct variables. In other words, the four columns together form one collection of data, and each column is a subgroup of that collection.</p>
<p>To pivot, we transfer this “column grouping” to the standard dplyr “row grouping.” To do this we just take our groups out of the different columns and merge them into one. The result is a consolidated column of data (<code>value</code>), along with a standard (row) grouping variable (<code>type</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">iris2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_by2.html">group_by2</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">Species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/colgrp.html">colgrp</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"type"</span><span class="op">)</span>

<span class="fu"><a href="../reference/pivot_grps.html">pivot_grps</a></span><span class="op">(</span><span class="va">iris2</span>, rows <span class="op">=</span> <span class="st">"type"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble:    600 x 3</span>
<span class="co">#&gt; # Row indices: Species, type [12]</span>
<span class="co">#&gt;    Species type         value</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;chr&gt;        &lt;dbl&gt;</span>
<span class="co">#&gt;  1 setosa  Sepal.Length   5.1</span>
<span class="co">#&gt;  2 setosa  Sepal.Length   4.9</span>
<span class="co">#&gt;  3 setosa  Sepal.Length   4.7</span>
<span class="co">#&gt;  4 setosa  Sepal.Length   4.6</span>
<span class="co">#&gt;  5 setosa  Sepal.Length   5  </span>
<span class="co">#&gt;  6 setosa  Sepal.Length   5.4</span>
<span class="co">#&gt;  7 setosa  Sepal.Length   4.6</span>
<span class="co">#&gt;  8 setosa  Sepal.Length   5  </span>
<span class="co">#&gt;  9 setosa  Sepal.Length   4.4</span>
<span class="co">#&gt; 10 setosa  Sepal.Length   4.9</span>
<span class="co">#&gt; # … with 590 more rows</span></pre></div>
<p>So, pivoting to longer is the same as converting column groupings to row groupings, and pivoting to wider just does the inverse.</p>
</div>
<div id="inapplicable-group-pivoting" class="section level4">
<h4 class="hasAnchor">
<a href="#inapplicable-group-pivoting" class="anchor"></a>Inapplicable group pivoting</h4>
<p>Consider this example dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
  subgrp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="cn">NA</span><span class="op">)</span>,
  val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.1</span>, <span class="fl">2.8</span>, <span class="fl">4.0</span>, <span class="fl">3.8</span>, <span class="fl">10.2</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;     grp subgrp   val</span>
<span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1      1   3.1</span>
<span class="co">#&gt; 2     1      2   2.8</span>
<span class="co">#&gt; 3     1      3   4  </span>
<span class="co">#&gt; 4     1      4   3.8</span>
<span class="co">#&gt; 5     2     NA  10.2</span></pre></div>
<p>Imagine we want to convert the row grouping defined by <code>grp</code> into a column grouping. Without inapplicable groups we get this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">regular_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_by2.html">group_by2</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">grp</span>, <span class="va">subgrp</span><span class="op">)</span>
<span class="fu"><a href="../reference/pivot_grps.html">pivot_grps</a></span><span class="op">(</span><span class="va">regular_df</span>, cols <span class="op">=</span> <span class="st">"grp"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble:    5 x 2</span>
<span class="co">#&gt; # Row indices: subgrp [5]</span>
<span class="co">#&gt; # Col index:   grp</span>
<span class="co">#&gt;   subgrp val$`1`  $`2`</span>
<span class="co">#&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1      1     3.1  NA  </span>
<span class="co">#&gt; 2      2     2.8  NA  </span>
<span class="co">#&gt; 3      3     4    NA  </span>
<span class="co">#&gt; 4      4     3.8  NA  </span>
<span class="co">#&gt; 5     NA    NA    10.2</span></pre></div>
<p>It looks a bit off. What if we wanted <code>val_2 == 10.2</code> for all values of subgrp? In other words, what if <code>val = 10.2</code> describes the entire second group?</p>
<p>This is an example of an operation that is very challenging to write with standard pivoting functions, but trivial with inapplicable groups. Simply group like this before pivoting:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">igrp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_by2.html">group_by2</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">grp</span>, subgrp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
<span class="fu"><a href="../reference/pivot_grps.html">pivot_grps</a></span><span class="op">(</span><span class="va">igrp_df</span>, cols <span class="op">=</span> <span class="st">"grp"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble:    4 x 2</span>
<span class="co">#&gt; # Row indices: subgrp [4]</span>
<span class="co">#&gt; # Col index:   grp</span>
<span class="co">#&gt;   subgrp val$`1`  $`2`</span>
<span class="co">#&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1      1     3.1  10.2</span>
<span class="co">#&gt; 2      2     2.8  10.2</span>
<span class="co">#&gt; 3      3     4    10.2</span>
<span class="co">#&gt; 4      4     3.8  10.2</span></pre></div>
<p>In this case we have a hierarchical grouping, where there are allowed to be multiple values for each value of <code>grp</code> but we may also have a single value that describes all the subgroups.</p>
<p>Note also how the only difference is in the grouping structure. The operation itself remains concise and easy to understand.</p>
</div>
</div>
<div id="later-selecting-data-for-computation" class="section level3">
<h3 class="hasAnchor">
<a href="#later-selecting-data-for-computation" class="anchor"></a>Later: selecting data for computation</h3>
<p>It is common to have a calculation to apply to only a subset of the data. For example, if you have group A and group B, you may be interested in calculating a mean for group A but leaving it missing for all the rows in group B. Depending on the calculation, this can be tough to express.</p>
<p>In mtcars, if we want the mean of <code>hp</code> for all rows where <code>vs == 1</code>, the easiest way is something like the following:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">mtcars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/group_by2.html">group_by2</a></span><span class="op">(</span>vs <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hp_mean_vs1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hp</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Mutations are not currently provided in <code>groups</code> but will be added in the future.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas Griffiths.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
